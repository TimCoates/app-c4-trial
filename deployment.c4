specification {
  tag Terraform
  tag Bash
  tag AzDO
  deploymentNode environment
  deploymentNode region
  deploymentNode zone
  deploymentNode kubernetes {
    // Nodes have same styling options
    style {
      color blue
      icon azure:aks-automatic
      multiple true
    }
  }
  deploymentNode podTerraform {
    #Terraform
    notation 'K8S Pod, deployed by Terraform'
    technology 'Kubernetes Pod'
    style { icon tech:terraform }
  }
  deploymentNode podBash {
    #Bash
    notation 'K8S Pod, deployed by shell script'
    technology 'Kubernetes Pod'
    style { icon tech:bash }
  }
  deploymentNode podAzDO {
    #Bash
    notation 'K8S Pod, deployed by Azure DevOps'
    technology 'Kubernetes Pod'
    style { icon azure:azure-dev-ops }
  }
}

deployment {
  environment prod {
    UKS = region 'UK South' {
      cluster1 = kubernetes 'Kubernetes Cluster South 1' {
        podMetrics = podTerraform 'Metrics Server'
        podTigera = podTerraform 'tigera'
        podCalico = podTerraform 'Calico'
        podDefender = podTerraform 'Defender'
        podKonnectivity = podTerraform 'Konnectivity'
        podDNS = podTerraform 'CoreDNS'

        podCertMgr = podBash 'Cert Manager'
        podNginxIngress = podBash 'nginx-ingress'
        podOutCold = podBash 'OutCold Collector'
        podCSI = podBash 'CSI Driver'

        podIproxy = podAzDO 'iproxy'
        podUtil = instanceOf nhsappservice.backend.utiladapter 'Util Adapter' { #AzDO }
        podGpc = instanceOf nhsappservice.backend.gpconnectadapter 'GP Connect Adapter' { #AzDO }
        podPds = instanceOf nhsappservice.backend.pdsadapter 'PDS Adapter' { #AzDO }
        podEps = instanceOf nhsappservice.backend.epsadapter 'EPS Adapter' { #AzDO }
        podSCS = instanceOf nhsappservice.backend.secondarycareadapter 'SCS Adapter' { #AzDO }
        podCid = podAzDO 'Citizen ID (NHS login)'
        podEventLogger = instanceOf nhsappservice.backend.eventLogger 'Event Logger' { #AzDO }
        podSjr = instanceOf nhsappservice.backend.monolith.sjrapi 'SJR'
        podBackend = instanceOf nhsappservice.backend.monolith 'Backend'
        podWeb = podAzDO 'Web' {
          description 'What the user sees'
        }
      }
      cluster2 = kubernetes 'Kubernetes Cluster South 2' {
        podMetrics = podTerraform 'Metrics Server'
        podTigera = podTerraform 'tigera'
        podCalico = podTerraform 'Calico'
        podDefender = podTerraform 'Defender'
        podKonnectivity = podTerraform 'Konnectivity'
        podDNS = podTerraform 'CoreDNS'

        podCertMgr = podBash 'Cert Manager'
        podNginxIngress = podBash 'nginx-ingress'
        podOutCold = podBash 'OutCold Collector'
        podCSI = podBash 'CSI Driver'

        podIproxy = podAzDO 'iproxy'
        podUtil = instanceOf nhsappservice.backend.utiladapter 'Util Adapter' { #AzDO }
        podGpc = instanceOf nhsappservice.backend.gpconnectadapter 'GP Connect Adapter' { #AzDO }
        podPds = instanceOf nhsappservice.backend.pdsadapter 'PDS Adapter' { #AzDO }
        podEps = instanceOf nhsappservice.backend.epsadapter 'EPS Adapter' { #AzDO }
        podSCS = instanceOf nhsappservice.backend.secondarycareadapter 'SCS Adapter' { #AzDO }
        podCid = podAzDO 'Citizen ID (NHS login)'
        podEventLogger = instanceOf nhsappservice.backend.eventLogger 'Event Logger' { #AzDO }
        podSjr = instanceOf nhsappservice.backend.monolith.sjrapi 'SJR'
        podBackend = instanceOf nhsappservice.backend.monolith 'Backend'
        podWeb = podAzDO 'Web' {
          description 'What the user sees'
        }
      }
    }
    UKW = region 'UK West' {
      cluster = kubernetes 'Kubernetes Cluster West 1' {
        podMetrics = podTerraform 'Metrics Server'
        podTigera = podTerraform 'tigera'
        podCalico = podTerraform 'Calico'
        podDefender = podTerraform 'Defender'
        podKonnectivity = podTerraform 'Konnectivity'
        podDNS = podTerraform 'CoreDNS'

        podCertMgr = podBash 'Cert Manager'
        podNginxIngress = podBash 'nginx-ingress'
        podOutCold = podBash 'OutCold Collector'
        podCSI = podBash 'CSI Driver'

        podIproxy = podAzDO 'iproxy'
        podUtil = instanceOf nhsappservice.backend.utiladapter 'Util Adapter' { #AzDO }
        podGpc = instanceOf nhsappservice.backend.gpconnectadapter 'GP Connect Adapter' { #AzDO }
        podPds = instanceOf nhsappservice.backend.pdsadapter 'PDS Adapter' { #AzDO }
        podEps = instanceOf nhsappservice.backend.epsadapter 'EPS Adapter' { #AzDO }
        podSCS = instanceOf nhsappservice.backend.secondarycareadapter 'SCS Adapter' { #AzDO }
        podCid = podAzDO 'Citizen ID (NHS login)'
        podEventLogger = instanceOf nhsappservice.backend.eventLogger 'Event Logger' { #AzDO }
        podSjr = instanceOf nhsappservice.backend.monolith.sjrapi 'SJR'
        podBackend = instanceOf nhsappservice.backend.monolith 'Backend'
        podWeb = podAzDO 'Web' {
          description 'What the user sees'
        }
      }
    }
  }
}
views{
  deployment view deploymentIndex {
    title 'Deployment / Production Deployment / Index'
    include prod, prod.UKS, prod.UKW
  	autoLayout TopBottom
	}

  deployment view uks {
    title 'Deployment / Production Deployment / UK South / Index'
    include prod, prod.UKS, prod.UKS.cluster1, prod.UKS.cluster2
  }
  deployment view ukw {
    title 'Deployment / Production Deployment / UK West / Index'
    include prod, prod.UKW, prod.UKW.cluster
  }

  /**
   * @likec4-generated(v1)
   * iKRoYXNo2Sg5YzQ1NDBmZjUyYzEwZjNiYzNhYTdlMTM5NjY2YmYzYmMyMTk5N2I0qmF1dG9MYXlvdXSBqWRpcmVjdGlvbqJUQqF4AqF5FaV3aWR0aM0JOKZoZWlnaHTNBWulbm9kZXPeABekcHJvZIKhYpQCFc0JOM0Fa6Fjw6hwcm9kLlVLU4KhYpQqTM0I6M0FDKFjw7Fwcm9kLlVLUy5jbHVzdGVyMYKhYpRSzIPNCJjNBK2hY8O8cHJvZC5VS1MuY2x1c3RlcjEucG9kTWV0cmljc4KhYpR6zLrNAUDMtKFjwrtwcm9kLlVLUy5jbHVzdGVyMS5wb2RUaWdlcmGCoWKUzQI8zLrNAUDMtKFjwrtwcm9kLlVLUy5jbHVzdGVyMS5wb2RDYWxpY2+CoWKUzQP+zLrNAUDMtKFjwr1wcm9kLlVLUy5jbHVzdGVyMS5wb2REZWZlbmRlcoKhYpTNBcDMus0BQMy0oWPC2SFwcm9kLlVL
   * Uy5jbHVzdGVyMS5wb2RLb25uZWN0aXZpdHmCoWKUzQeCzLrNAUDMtKFjwrhwcm9kLlVLUy5jbHVzdGVyMS5wb2RETlOCoWKUes0B580BQMy0oWPCvHByb2QuVUtTLmNsdXN0ZXIxLnBvZENlcnRNZ3KCoWKUzQI8zQHnzQFAzLShY8LZIXByb2QuVUtTLmNsdXN0ZXIxLnBvZE5naW54SW5ncmVzc4KhYpTNA/7NAefNAUDMtKFjwrxwcm9kLlVLUy5jbHVzdGVyMS5wb2RPdXRDb2xkgqFilM0FwM0B580BQMy0oWPCuHByb2QuVUtTLmNsdXN0ZXIxLnBvZENTSYKhYpTNB4LNAefNAUDMtKFjwrtwcm9kLlVLUy5jbHVzdGVyMS5wb2RJcHJveHmCoWKUes0DHs0BQMy0oWPCuXByb2QuVUtTLmNsdXN0ZXIxLnBvZFV0aWyCoWKUzQI8zQMezQFAzLShY8K4cHJvZC5VS1MuY2x1
   * c3RlcjEucG9kR3BjgqFilM0D/s0DHs0Bbcy0oWPCuHByb2QuVUtTLmNsdXN0ZXIxLnBvZFBkc4KhYpTNBcDNAx7NAUDMtKFjwrhwcm9kLlVLUy5jbHVzdGVyMS5wb2RFcHOCoWKUzQeCzQMezQFAzLShY8K4cHJvZC5VS1MuY2x1c3RlcjEucG9kQ2lkgqFilHrNBFTNAUDMtKFjwtkgcHJvZC5VS1MuY2x1c3RlcjEucG9kRXZlbnRMb2dnZXKCoWKUzQI8zQRUzQFAzLShY8K4cHJvZC5VS1MuY2x1c3RlcjEucG9kU2pygqFilM0D/s0EVM0BQMy0oWPCvHByb2QuVUtTLmNsdXN0ZXIxLnBvZEJhY2tlbmSCoWKUzQXAzQRUzQFAzLShY8K4cHJvZC5VS1MuY2x1c3RlcjEucG9kV2VigqFilM0Hgs0EVM0BQMy0oWPCpWVkZ2VzgA==
   */
  deployment view uks1 {
    title 'Deployment / Production Deployment / UK South / UK South Cluster 1'
    include prod, prod.UKS, prod.UKS.cluster1, prod.UKS.cluster1.*
  }
  /**
   * @likec4-generated(v1)
   * iKRoYXNo2ShiYjc0OTEzZjdhYzM2NDIxYmE2YmUwMjQxZTE0Zjg3MTg3NDVlNjdjqmF1dG9MYXlvdXSBqWRpcmVjdGlvbqJUQqF4AKF5FaV3aWR0aM0JOqZoZWlnaHTNBQmlbm9kZXPeABekcHJvZIKhYpQAFc0JOs0FCaFjw6hwcm9kLlVLU4KhYpQoTM0I6s0EqqFjw7Fwcm9kLlVLUy5jbHVzdGVyMoKhYpRQzIPNCJrNBEuhY8O8cHJvZC5VS1MuY2x1c3RlcjIucG9kTWV0cmljc4KhYpR4zLrNAUDMtKFjwrtwcm9kLlVLUy5jbHVzdGVyMi5wb2RUaWdlcmGCoWKUzQI6zLrNAUDMtKFjwrtwcm9kLlVLUy5jbHVzdGVyMi5wb2RDYWxpY2+CoWKUzQP8zLrNAUDMtKFjwr1wcm9kLlVLUy5jbHVzdGVyMi5wb2REZWZlbmRlcoKhYpTNBcDMus0BQMy0oWPC2SFwcm9kLlVL
   * Uy5jbHVzdGVyMi5wb2RLb25uZWN0aXZpdHmCoWKUzQeCzLrNAUDMtKFjwrhwcm9kLlVLUy5jbHVzdGVyMi5wb2RETlOCoWKUeM0B1c0BQMy0oWPCvHByb2QuVUtTLmNsdXN0ZXIyLnBvZENlcnRNZ3KCoWKUzQI6zQHVzQFAzLShY8LZIXByb2QuVUtTLmNsdXN0ZXIyLnBvZE5naW54SW5ncmVzc4KhYpTNA/zNAdXNAUDMtKFjwrxwcm9kLlVLUy5jbHVzdGVyMi5wb2RPdXRDb2xkgqFilM0FwM0B1c0BQMy0oWPCuHByb2QuVUtTLmNsdXN0ZXIyLnBvZENTSYKhYpTNB4LNAdXNAUDMtKFjwrtwcm9kLlVLUy5jbHVzdGVyMi5wb2RJcHJveHmCoWKUeM0C3s0BQMy0oWPCuXByb2QuVUtTLmNsdXN0ZXIyLnBvZFV0aWyCoWKUzQI6zQLezQFAzLShY8K4cHJvZC5VS1MuY2x1
   * c3RlcjIucG9kR3BjgqFilM0D/M0C3s0Bbcy0oWPCuHByb2QuVUtTLmNsdXN0ZXIyLnBvZFBkc4KhYpTNBcDNAt7NAUDMtKFjwrhwcm9kLlVLUy5jbHVzdGVyMi5wb2RFcHOCoWKUzQeCzQLezQFAzLShY8K4cHJvZC5VS1MuY2x1c3RlcjIucG9kQ2lkgqFilHjNA/LNAUDMtKFjwtkgcHJvZC5VS1MuY2x1c3RlcjIucG9kRXZlbnRMb2dnZXKCoWKUzQI6zQPyzQFAzLShY8K4cHJvZC5VS1MuY2x1c3RlcjIucG9kU2pygqFilM0D/M0D8s0BQMy0oWPCvHByb2QuVUtTLmNsdXN0ZXIyLnBvZEJhY2tlbmSCoWKUzQXAzQPyzQFAzLShY8K4cHJvZC5VS1MuY2x1c3RlcjIucG9kV2VigqFilM0Hgs0D8s0BQMy0oWPCpWVkZ2VzgA==
   */
  deployment view uks2 {
    title 'Deployment / Production Deployment / UK South / UK South Cluster 2'
    include prod, prod.UKS, prod.UKS.cluster2, prod.UKS.cluster2.*
  }
  /**
   * @likec4-generated(v1)
   * iKRoYXNo2Sg0N2EyMjhiODZiZDUxMWRjNDE3MzczNTI0NWRlNmRiYzg3OGMxYzEzqmF1dG9MYXlvdXSBqWRpcmVjdGlvbqJUQqF4AqF5FaV3aWR0aM0Hg6ZoZWlnaHTNBgGlbm9kZXPeABekcHJvZIKhYpQCFc0Hg80GAaFjw6hwcm9kLlVLV4KhYpQqTM0HM80FoqFjw7Bwcm9kLlVLVy5jbHVzdGVygqFilFLMg80G480FQ6Fjw7twcm9kLlVLVy5jbHVzdGVyLnBvZE1ldHJpY3OCoWKUesy6zQFAzLShY8K6cHJvZC5VS1cuY2x1c3Rlci5wb2RUaWdlcmGCoWKUes0ByM0BQMy0oWPCunByb2QuVUtXLmNsdXN0ZXIucG9kQ2FsaWNvgqFilHrNAtTNAUDMtKFjwrxwcm9kLlVLVy5jbHVzdGVyLnBvZERlZmVuZGVygqFilM0CFsy6zQFAzLShY8LZIHByb2QuVUtXLmNsdXN0
   * ZXIucG9kS29ubmVjdGl2aXR5gqFilM0CFs0ByM0BQMy0oWPCt3Byb2QuVUtXLmNsdXN0ZXIucG9kRE5TgqFilM0CFs0C1M0BQMy0oWPCu3Byb2QuVUtXLmNsdXN0ZXIucG9kQ2VydE1ncoKhYpTNA+TMus0BQMy0oWPC2SBwcm9kLlVLVy5jbHVzdGVyLnBvZE5naW54SW5ncmVzc4KhYpTNA+TNAcjNAUDMtKFjwrpwcm9kLlVLVy5jbHVzdGVyLnBvT3V0Q29sZIKhYpTNA+TNAtTNAUDMtKFjwrdwcm9kLlVLVy5jbHVzdGVyLnBvZENTSYKhYpTNBZLMus0BQMy0oWPCunByb2QuVUtXLmNsdXN0ZXIucG9kSXByb3h5gqFilHrNA9TNAUDMtKFjwrhwcm9kLlVLVy5jbHVzdGVyLnBvZFV0aWyCoWKUzQIWzQPUzQFAzLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RHcGOCoWKU
   * zQPkzQPUzQFtzLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RQZHOCoWKUzQWSzQPUzQF7zLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RFcHOCoWKUzQWSzQLUzQFAzLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RDaWSCoWKUzQWSzQTqzQFAzLShY8K/cHJvZC5VS1cuY2x1c3Rlci5wb2RFdmVudExvZ2dlcoKhYpTNBZLNAcjNAUDMtKFjwrdwcm9kLlVLVy5jbHVzdGVyLnBvZFNqcoKhYpR6zQTqzQFAzLShY8K7cHJvZC5VS1cuY2x1c3Rlci5wb2RCYWNrZW5kgqFilM0CFs0E6s0BQMy0oWPCt3Byb2QuVUtXLmNsdXN0ZXIucG9kV2VigqFilM0D5M0E6s0BQMy0oWPCpWVkZ2VzgA==
   */
  deployment view ukw1 {
    title 'Deployment / Production Deployment / UK West / UK West Cluster'
    include prod, prod.UKW, prod.UKW.cluster, prod.UKW.cluster.*
  }

}