specification {
  tag Terraform
  tag Bash
  tag AzDO
  deploymentNode environment
  deploymentNode region
  deploymentNode zone
  deploymentNode kubernetes {
    // Nodes have same styling options
    style {
      color blue
      icon azure:aks-automatic
      multiple true
    }
  }
  deploymentNode podTerraform {
    #Terraform
    notation 'K8S Pod, deployed by Terraform'
    technology 'Kubernetes Pod'
    style { icon tech:terraform }
  }
  deploymentNode podBash {
    #Bash
    notation 'K8S Pod, deployed by shell script'
    technology 'Kubernetes Pod'
    style { icon tech:bash }
  }
  deploymentNode podAzDO {
    #Bash
    notation 'K8S Pod, deployed by Azure DevOps'
    technology 'Kubernetes Pod'
    style { icon azure:azure-dev-ops }
  }
}

deployment {
  environment prod {
    UKS = region 'UK South' {
      cluster1 = kubernetes 'Kubernetes Cluster South 1' {
      cluster = kubernetes 'Kubernetes Cluster West 1' {
        podMetrics = podTerraform 'Metrics Server'
        podTigera = podTerraform 'tigera'
        podCalico = podTerraform 'Calico'
        podDefender = podTerraform 'Defender'
        podKonnectivity = podTerraform 'Konnectivity'
        podDNS = podTerraform 'CoreDNS'

        podCertMgr = podBash 'Cert Manager'
        podNginxIngress = podBash 'nginx-ingress'
        poOutCold = podBash 'OutCold Collector'
        podCSI = podBash 'CSI Driver'

        podIproxy = podAzDO 'iproxy'
        podUtil = instanceOf nhsappservice.backend.utiladapter 'Util Adapter' { #AzDO }
        podGpc = instanceOf nhsappservice.backend.gpconnectadapter 'GP Connect Adapter' { #AzDO }
        podPds = instanceOf nhsappservice.backend.pdsadapter 'PDS Adapter' { #AzDO }
        podEps = instanceOf nhsappservice.backend.epsadapter 'EPS Adapter' { #AzDO }
        podCid = podAzDO 'Citizen ID (NHS login)'
        podEventLogger = instanceOf nhsappservice.backend.eventLogger 'Event Logger' { #AzDO }
        podSjr = instanceOf nhsappservice.backend.monolith.sjrapi 'SJR'
        podBackend = instanceOf nhsappservice.backend.monolith 'Backend'
        podWeb = podAzDO 'Web' {
          description 'What the user sees'
        }
      }
    }
      cluster2 = kubernetes 'Kubernetes Cluster South 2' {
      cluster = kubernetes 'Kubernetes Cluster West 1' {
        podMetrics = podTerraform 'Metrics Server'
        podTigera = podTerraform 'tigera'
        podCalico = podTerraform 'Calico'
        podDefender = podTerraform 'Defender'
        podKonnectivity = podTerraform 'Konnectivity'
        podDNS = podTerraform 'CoreDNS'

        podCertMgr = podBash 'Cert Manager'
        podNginxIngress = podBash 'nginx-ingress'
        poOutCold = podBash 'OutCold Collector'
        podCSI = podBash 'CSI Driver'

        podIproxy = podAzDO 'iproxy'
        podUtil = instanceOf nhsappservice.backend.utiladapter 'Util Adapter' { #AzDO }
        podGpc = instanceOf nhsappservice.backend.gpconnectadapter 'GP Connect Adapter' { #AzDO }
        podPds = instanceOf nhsappservice.backend.pdsadapter 'PDS Adapter' { #AzDO }
        podEps = instanceOf nhsappservice.backend.epsadapter 'EPS Adapter' { #AzDO }
        podCid = podAzDO 'Citizen ID (NHS login)'
        podEventLogger = instanceOf nhsappservice.backend.eventLogger 'Event Logger' { #AzDO }
        podSjr = instanceOf nhsappservice.backend.monolith.sjrapi 'SJR'
        podBackend = instanceOf nhsappservice.backend.monolith 'Backend'
        podWeb = podAzDO 'Web' {
          description 'What the user sees'
        }
      }
    }
    }
    UKW = region 'UK West' {
      cluster = kubernetes 'Kubernetes Cluster West 1' {
        podMetrics = podTerraform 'Metrics Server'
        podTigera = podTerraform 'tigera'
        podCalico = podTerraform 'Calico'
        podDefender = podTerraform 'Defender'
        podKonnectivity = podTerraform 'Konnectivity'
        podDNS = podTerraform 'CoreDNS'

        podCertMgr = podBash 'Cert Manager'
        podNginxIngress = podBash 'nginx-ingress'
        poOutCold = podBash 'OutCold Collector'
        podCSI = podBash 'CSI Driver'

        podIproxy = podAzDO 'iproxy'
        podUtil = instanceOf nhsappservice.backend.utiladapter 'Util Adapter' { #AzDO }
        podGpc = instanceOf nhsappservice.backend.gpconnectadapter 'GP Connect Adapter' { #AzDO }
        podPds = instanceOf nhsappservice.backend.pdsadapter 'PDS Adapter' { #AzDO }
        podEps = instanceOf nhsappservice.backend.epsadapter 'EPS Adapter' { #AzDO }
        podCid = podAzDO 'Citizen ID (NHS login)'
        podEventLogger = instanceOf nhsappservice.backend.eventLogger 'Event Logger' { #AzDO }
        podSjr = instanceOf nhsappservice.backend.monolith.sjrapi 'SJR'
        podBackend = instanceOf nhsappservice.backend.monolith 'Backend'
        podWeb = podAzDO 'Web' {
          description 'What the user sees'
        }
      }
    }
  }
}
views{
  deployment view deploymentIndex {
    title 'Deployment / Production Deployment / Index'
    include prod, prod.UKS, prod.UKW
  	autoLayout TopBottom
	}

  deployment view uks {
    title 'Deployment / Production Deployment / UK South / Index'
    include prod, prod.UKS, prod.UKS.cluster1, prod.UKS.cluster2
  }
  deployment view ukw {
    title 'Deployment / Production Deployment / UK West / Index'
    include prod, prod.UKW, prod.UKW.cluster
  }

  deployment view uks1 {
    title 'Deployment / Production Deployment / UK South / UK South Cluster 1'
    include prod, prod.UKS, prod.UKS.cluster1, prod.UKS.cluster1.*
  }
  deployment view uks2 {
    title 'Deployment / Production Deployment / UK South / UK South Cluster 2'
    include prod, prod.UKS, prod.UKS.cluster2, prod.UKS.cluster2.*
  }
  /**
   * @likec4-generated(v1)
   * iKRoYXNo2Sg0N2EyMjhiODZiZDUxMWRjNDE3MzczNTI0NWRlNmRiYzg3OGMxYzEzqmF1dG9MYXlvdXSBqWRpcmVjdGlvbqJUQqF4AqF5FaV3aWR0aM0Hg6ZoZWlnaHTNBgGlbm9kZXPeABekcHJvZIKhYpQCFc0Hg80GAaFjw6hwcm9kLlVLV4KhYpQqTM0HM80FoqFjw7Bwcm9kLlVLVy5jbHVzdGVygqFilFLMg80G480FQ6Fjw7twcm9kLlVLVy5jbHVzdGVyLnBvZE1ldHJpY3OCoWKUesy6zQFAzLShY8K6cHJvZC5VS1cuY2x1c3Rlci5wb2RUaWdlcmGCoWKUes0ByM0BQMy0oWPCunByb2QuVUtXLmNsdXN0ZXIucG9kQ2FsaWNvgqFilHrNAtTNAUDMtKFjwrxwcm9kLlVLVy5jbHVzdGVyLnBvZERlZmVuZGVygqFilM0CFsy6zQFAzLShY8LZIHByb2QuVUtXLmNsdXN0
   * ZXIucG9kS29ubmVjdGl2aXR5gqFilM0CFs0ByM0BQMy0oWPCt3Byb2QuVUtXLmNsdXN0ZXIucG9kRE5TgqFilM0CFs0C1M0BQMy0oWPCu3Byb2QuVUtXLmNsdXN0ZXIucG9kQ2VydE1ncoKhYpTNA+TMus0BQMy0oWPC2SBwcm9kLlVLVy5jbHVzdGVyLnBvZE5naW54SW5ncmVzc4KhYpTNA+TNAcjNAUDMtKFjwrpwcm9kLlVLVy5jbHVzdGVyLnBvT3V0Q29sZIKhYpTNA+TNAtTNAUDMtKFjwrdwcm9kLlVLVy5jbHVzdGVyLnBvZENTSYKhYpTNBZLMus0BQMy0oWPCunByb2QuVUtXLmNsdXN0ZXIucG9kSXByb3h5gqFilHrNA9TNAUDMtKFjwrhwcm9kLlVLVy5jbHVzdGVyLnBvZFV0aWyCoWKUzQIWzQPUzQFAzLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RHcGOCoWKU
   * zQPkzQPUzQFtzLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RQZHOCoWKUzQWSzQPUzQF7zLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RFcHOCoWKUzQWSzQLUzQFAzLShY8K3cHJvZC5VS1cuY2x1c3Rlci5wb2RDaWSCoWKUzQWSzQTqzQFAzLShY8K/cHJvZC5VS1cuY2x1c3Rlci5wb2RFdmVudExvZ2dlcoKhYpTNBZLNAcjNAUDMtKFjwrdwcm9kLlVLVy5jbHVzdGVyLnBvZFNqcoKhYpR6zQTqzQFAzLShY8K7cHJvZC5VS1cuY2x1c3Rlci5wb2RCYWNrZW5kgqFilM0CFs0E6s0BQMy0oWPCt3Byb2QuVUtXLmNsdXN0ZXIucG9kV2VigqFilM0D5M0E6s0BQMy0oWPCpWVkZ2VzgA==
   */
  deployment view ukw1 {
    title 'Deployment / Production Deployment / UK West / UK West Cluster'
    include prod, prod.UKW, prod.UKW.cluster, prod.UKW.cluster.*
  }

}